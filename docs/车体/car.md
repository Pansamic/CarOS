# 对于不同小车模型的使用说明

## 目录

## 1. 简介

`CarOS/src/car/`文件夹下有很多文件，这些文件都是适配不同类型小车的代码。`c_car.h`和`c_car.c`是管理所有小车代码的文件。

## 2. 通用使用方法

就像实际在拼装车子一样，要想让整个车子动起来，必须要搭好车身框架、装上电机、装上轮子、装上其他外设、连接好遥控器等等。在CarOS中，也是类似的思路，首先我们需要初始化一个小车框架，然后给小车加上轮子距离、轮子直径、加上电机驱动、加上其他外设、连接好串口控制台等等，这样才能让整个车子跑起来。

以下**API的名称**不会随着小车模型的不同而改变。

### 2.1 初始化

初始化一个小车模型就必须要知道小车的类型、车子尺寸等基本信息。以4轮麦克纳姆轮小车为例，请你想象，如果我们要画出一辆麦克纳姆轮小车，我们要知道什么信息？这辆小车到底是像林肯加长轿车那样长还是四四方方？轮胎究竟是直径一米还是直径仅几微米小到看不见？如果我们一旦已知了上述信息，那么这个小车的框架图就基本上定死了，除非这个小车非常高（不过不在我们考虑范围之内）。一个4轮麦克纳姆轮小车的最基本参数就是轮胎之间的距离和轮胎直径，就这样我们搭好了麦克纳姆轮小车的框架。其他的小车类型也是一样的，只要最基本的参数传进结构体中，小车的模型就算是被搭好了。

初始化小车的函数是`Car_Init()`函数。该函数由于小车模型不同而有不同版本，每个版本的函数名都是一样的，但是函数参数有差别。只要修改`CarOS/c_config.h`中的`CAR_TYPE`宏定义即可改变`Car_Init()`函数的声明及定义。

### 2.2 添加电机及驱动

一辆小车必须有轮子、有电机才能跑起来，所以我们需要生成并初始化几个电机结构体，然后把电机安装在小车上，小车才能跑起来。

在不同的小车模型的代码文件中已经定义好了与该小车模型相匹配的数量的电机结构体，所以无需用户再次定义。详见`CarOS/src/car/c_xwheel_xxxx.c`（x代表轮子数量，xxxx代表小车模型）文件开头部分。

**关于初始化**，需要调用`DCMotor_Init()`函数来初始化电机，该函数将参数传递给电机结构体，函数详见文档`电机/motor.md`。

为电机添加**硬件驱动**。根据电路实际情况，为电机添加与硬件电路相匹配的驱动。举例：我的小车使用L298N模块来驱动电机，那么需要调用`DCMotor_AddL298N(&xxxMotor,port1,pin1,port2,pin2)`来为电机添加L298N驱动。

### 2.3 添加电机控制算法

一般来说小车配套的直流电机具有编码器，使用编码器可以实现直流电机的速度环闭环控制。除了**常见的PID算法**，还有滑模控制、模糊控制等控制算法来实现电机速度控制，在v1.x版本中，只支持PID控制，在v2.3及以后的版本中可能会**逐步支持其他速度环控制算法**。

使用`DCMotor_AddPID()`来为电机添加PID速度环闭环控制算法。

### 2.4 添加编码器

如果只添加速度环控制算法而不添加编码器，那将毫无作用，因为根本就不能获取到电机实际的转速是多少。

使用`DCMotor_AddEncoder()`函数来为电机添加编码器。

## 3. 不同车型的使用说明

在以下文档查看具体说明

[4轮麦克纳姆轮小车](https://github.com/Pansamic/CarOS/blob/master/docs/%E8%BD%A6%E4%BD%93/4wheel_mecanum.md)

